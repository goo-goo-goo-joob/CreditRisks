<p>
    <a href="https://yadi.sk/d/6AsNf7CqWiGFww" target="_blank">Пример документов</a>
</p>
<form enctype="multipart/form-data" id="generate_params">
    <div class="form-group">
        <label for="inn">ИНН</label>
        <input class="form-control" id="inn" name="inn" placeholder="ИНН" required type="text">
    </div>
    <div class="form-group">
        <label for="file_report">Файл с отчетностью</label>
        <input id="file_report" name="file_report" required type="file">
    </div>

    <div class="form-group">
        <input type="submit" class="btn btn-primary" value="Рассчитать"/>
    </div>
</form>
<div class="form-group">
    <table class="table table-striped" id="result_table" style="display: none">
        <caption style="caption-side: top">Расчет вероятности дефолта</caption>
        <thead>
        <tr>
            <th scope="col">Название модели предсказания</th>
            <th scope="col">Вероятность дефолта</th>
            <th scope="col">Влияние параметров</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<div aria-hidden="true" aria-labelledby="modelModal" class="modal fade" id='modelModal' role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Метрики качества модели</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<div aria-hidden="true" aria-labelledby="impactModal" class="modal fade" id='impactModal' role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Расчет влияния параметра</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form enctype="multipart/form-data" id="impact_param">
                    <input type="hidden" name="model_name">
                    <div class="form-group">
                        <label for="feature">Параметр</label>
                        <select class="form-control" id="feature" name="feature">
                    </div>
                    <div class="form-group">
                        <label for="tail">Левая граница моделирования</label>
                        <input class="form-control" id="tail" name="tail" placeholder="Левая граница моделирования" required type="number" value="0">
                    </div>
                    <div class="form-group">
                        <label for="head">Правая граница моделирования</label>
                        <input class="form-control" id="head" name="head" placeholder="Правая граница моделирования" required type="number" value="20000">
                    </div>
                    <div class="form-group">
                        <input type="submit" class="btn btn-primary" value="Рассчитать"/>
                    </div>
                </form>
                <div id="image_out">

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>
<script>
	function addElToSelector(){
		select = document.getElementById('feature');
		for (let i of features) {
		var opt = document.createElement('option');
			opt.value = i;
			opt.innerHTML = i;
			select.appendChild(opt);
		}			
	}

    function prepareModel(name) {
        $.ajax({
            url: '/api/model/' + name,
            type: 'GET',
            success: function (data) {
                let modal = $('#modelModal');
                let target = modal.find('.modal-body').empty();
                for (const [key, value] of Object.entries(data)) {
                    target.append(`<img src="data:image/png;base64, ${value}" alt="${key}"/>`)
                }
                modal.modal('show');
            },
            error: error_handler
        });
    }

    $('#impactModal').on('show.bs.modal', function (e) {
        let modal = $(this);
        let sender = $(e.relatedTarget);
        modal.find("input[name='model_name']").val(sender.data('model'));
        $('#image_out').empty();
    });
    $("#impact_param").on('submit', function (e) {
        e.preventDefault();
        let sender = $('#impact_param input[type=submit]');
        sender.prop('disabled', true);
        let fd = new FormData(this);
        let file = $('#file_report');
        fd.append('file_report', file[0].files[0]);
        $.ajax({
            url: '/api/impact',
            data: fd,
            processData: false,
            contentType: false,
            type: 'POST',
            success: function (data) {
                let target = $('#image_out').empty();
                target.append(`<img src="data:image/png;base64, ${data}" alt="Влияние параметра"  style="width: 100%"/>`)
            },
            error: error_handler,
            complete: function (jqXHR, textStatus) {
                sender.prop('disabled', false);
            }
        });
        return false;
    });
    $("#generate_params").on('submit', function (e) {
        e.preventDefault();
        let inn = $('#inn').val();
        let file = $('#file_report');
        let fd = new FormData(this);
        if (inn && file)
            $.ajax({
                url: '/api/calculate',
                data: fd,
                processData: false,
                contentType: false,
                type: 'POST',
                success: function (data) {
                    let target = $('#result_table');
                    target.show();
                    target = target.find('tbody').empty();
                    for (const [key, value] of Object.entries(data)) {
                        target.append(`<tr>
<th scope="row">
<button type="button" class="btn btn-primary wide-button" onclick="prepareModel('${key}')">
Модель "${key}"
</button>
</th>
<td style="text-align: center; font-size: large; color:red">${value}</td>
<th scope="row">
<button type="button" class="btn btn-success wide-button" data-toggle="modal" data-target="#impactModal" data-model="${key}">
Влияние параметра "${key}"
</button>
</th>
</tr>`)
                    }
                },
                error: error_handler
            });
        return false;
    });
	
	
	
features = { 'year_-1_11003' , 'year_-1_11004' ,
                     'year_-1_11103' , 'year_-1_11104' , 'year_-1_11203' ,
                     'year_-1_11204' , 'year_-1_11303' , 'year_-1_11304' ,
                     'year_-1_11403' , 'year_-1_11404' , 'year_-1_11503' ,
                     'year_-1_11504' , 'year_-1_11603' , 'year_-1_11604' ,
                     'year_-1_11703' , 'year_-1_11704' , 'year_-1_11803' ,
                     'year_-1_11804' , 'year_-1_11903' , 'year_-1_11904' ,
                     'year_-1_12003' , 'year_-1_12004' , 'year_-1_12103' ,
                     'year_-1_12104' , 'year_-1_12203' , 'year_-1_12204' ,
                     'year_-1_12303' , 'year_-1_12304' , 'year_-1_12403' ,
                     'year_-1_12404' , 'year_-1_12503' , 'year_-1_12504' ,
                     'year_-1_12603' , 'year_-1_12604' , 'year_-1_13003' ,
                     'year_-1_13004' , 'year_-1_13103' , 'year_-1_13104' ,
                     'year_-1_13203' , 'year_-1_13204' , 'year_-1_13403' ,
                     'year_-1_13404' , 'year_-1_13503' , 'year_-1_13504' ,
                     'year_-1_13603' , 'year_-1_13604' , 'year_-1_13703' ,
                     'year_-1_13704' , 'year_-1_14003' , 'year_-1_14004' ,
                     'year_-1_14103' , 'year_-1_14104' , 'year_-1_14203' ,
                     'year_-1_14204' , 'year_-1_14303' , 'year_-1_14304' ,
                     'year_-1_14503' , 'year_-1_14504' , 'year_-1_15003' ,
                     'year_-1_15004' , 'year_-1_15103' , 'year_-1_15104' ,
                     'year_-1_15203' , 'year_-1_15204' , 'year_-1_15303' ,
                     'year_-1_15304' , 'year_-1_15403' , 'year_-1_15404' ,
                     'year_-1_15503' , 'year_-1_15504' , 'year_-1_16003' ,
                     'year_-1_16004' , 'year_-1_17003' , 'year_-1_17004' ,
                     'year_-1_21003' , 'year_-1_21004' , 'year_-1_21103' ,
                     'year_-1_21104' , 'year_-1_21203' , 'year_-1_21204' ,
                     'year_-1_22003' , 'year_-1_22004' , 'year_-1_22103' ,
                     'year_-1_22104' , 'year_-1_22203' , 'year_-1_22204' ,
                     'year_-1_23003' , 'year_-1_23004' , 'year_-1_23103' ,
                     'year_-1_23104' , 'year_-1_23203' , 'year_-1_23204' ,
                     'year_-1_23303' , 'year_-1_23304' , 'year_-1_23403' ,
                     'year_-1_23404' , 'year_-1_23503' , 'year_-1_23504' ,
                     'year_-1_24003' , 'year_-1_24004' , 'year_-1_24103' ,
                     'year_-1_24104' , 'year_-1_24213' , 'year_-1_24214' ,
                     'year_-1_24303' , 'year_-1_24304' , 'year_-1_24503' ,
                     'year_-1_24504' , 'year_-1_24603' , 'year_-1_24604' ,
                     'year_-1_25003' , 'year_-1_25004' , 'year_-1_25103' ,
                     'year_-1_25104' , 'year_-1_25203' , 'year_-1_25204' ,
                     'year_-1_32003' , 'year_-1_32004' , 'year_-1_32005' ,
                     'year_-1_32006' , 'year_-1_32007' , 'year_-1_32008' ,
                     'year_-1_33003' , 'year_-1_33004' , 'year_-1_33005' ,
                     'year_-1_33006' , 'year_-1_33007' , 'year_-1_33008' ,
                     'year_-1_33103' , 'year_-1_33104' , 'year_-1_33105' ,
                     'year_-1_33106' , 'year_-1_33107' , 'year_-1_33108' ,
                     'year_-1_33117' , 'year_-1_33118' , 'year_-1_33125' ,
                     'year_-1_33127' , 'year_-1_33128' , 'year_-1_33135' ,
                     'year_-1_33137' , 'year_-1_33138' , 'year_-1_33143' ,
                     'year_-1_33144' , 'year_-1_33145' , 'year_-1_33148' ,
                     'year_-1_33153' , 'year_-1_33154' , 'year_-1_33155' ,
                     'year_-1_33157' , 'year_-1_33163' , 'year_-1_33164' ,
                     'year_-1_33165' , 'year_-1_33166' , 'year_-1_33167' ,
                     'year_-1_33168' , 'year_-1_33203' , 'year_-1_33204' ,
                     'year_-1_33205' , 'year_-1_33206' , 'year_-1_33207' ,
                     'year_-1_33208' , 'year_-1_33217' , 'year_-1_33218' ,
                     'year_-1_33225' , 'year_-1_33227' , 'year_-1_33228' ,
                     'year_-1_33235' , 'year_-1_33237' , 'year_-1_33238' ,
                     'year_-1_33243' , 'year_-1_33244' , 'year_-1_33245' ,
                     'year_-1_33247' , 'year_-1_33248' , 'year_-1_33253' ,
                     'year_-1_33254' , 'year_-1_33255' , 'year_-1_33257' ,
                     'year_-1_33258' , 'year_-1_33263' , 'year_-1_33264' ,
                     'year_-1_33265' , 'year_-1_33266' , 'year_-1_33267' ,
                     'year_-1_33268' , 'year_-1_33277' , 'year_-1_33278' ,
                     'year_-1_33305' , 'year_-1_33306' , 'year_-1_33307' ,
                     'year_-1_33406' , 'year_-1_33407' , 'year_-1_36003' ,
                     'year_-1_36004' , 'year_-1_41003' , 'year_-1_41103' ,
                     'year_-1_41113' , 'year_-1_41123' , 'year_-1_41133' ,
                     'year_-1_41193' , 'year_-1_41203' , 'year_-1_41213' ,
                     'year_-1_41223' , 'year_-1_41233' , 'year_-1_41243' ,
                     'year_-1_41293' , 'year_-1_42003' , 'year_-1_42103' ,
                     'year_-1_42113' , 'year_-1_42123' , 'year_-1_42133' ,
                     'year_-1_42143' , 'year_-1_42193' , 'year_-1_42203' ,
                     'year_-1_42213' , 'year_-1_42223' , 'year_-1_42233' ,
                     'year_-1_42243' , 'year_-1_42293' , 'year_-1_43003' ,
                     'year_-1_43103' , 'year_-1_43113' , 'year_-1_43123' ,
                     'year_-1_43133' , 'year_-1_43143' , 'year_-1_43193' ,
                     'year_-1_43203' , 'year_-1_43213' , 'year_-1_43223' ,
                     'year_-1_43233' , 'year_-1_43293' , 'year_-1_44003' ,
                     'year_-1_44903' , 'year_-1_61003' , 'year_-1_62003' ,
                     'year_-1_62103' , 'year_-1_62153' , 'year_-1_62203' ,
                     'year_-1_62303' , 'year_-1_62403' , 'year_-1_62503' ,
                     'year_-1_63003' , 'year_-1_63103' , 'year_-1_63113' ,
                     'year_-1_63123' , 'year_-1_63133' , 'year_-1_63203' ,
                     'year_-1_63213' , 'year_-1_63223' , 'year_-1_63233' ,
                     'year_-1_63243' , 'year_-1_63253' , 'year_-1_63263' ,
                     'year_-1_63303' , 'year_-1_63503' , 'year_-1_64003' ,
                     'year_0_11003' , 'year_0_11004' , 'year_0_11103' ,
                     'year_0_11104' , 'year_0_11203' , 'year_0_11204' , 'year_0_11303' ,
                     'year_0_11304' , 'year_0_11403' , 'year_0_11404' , 'year_0_11503' ,
                     'year_0_11504' , 'year_0_11603' , 'year_0_11604' , 'year_0_11703' ,
                     'year_0_11704' , 'year_0_11803' , 'year_0_11804' , 'year_0_11903' ,
                     'year_0_11904' , 'year_0_12003' , 'year_0_12004' , 'year_0_12103' ,
                     'year_0_12104' , 'year_0_12203' , 'year_0_12204' , 'year_0_12303' ,
                     'year_0_12304' , 'year_0_12403' , 'year_0_12404' , 'year_0_12503' ,
                     'year_0_12504' , 'year_0_12603' , 'year_0_12604' , 'year_0_13003' ,
                     'year_0_13004' , 'year_0_13103' , 'year_0_13104' , 'year_0_13203' ,
                     'year_0_13204' , 'year_0_13403' , 'year_0_13404' , 'year_0_13503' ,
                     'year_0_13504' , 'year_0_13603' , 'year_0_13604' , 'year_0_13703' ,
                     'year_0_13704' , 'year_0_14003' , 'year_0_14004' , 'year_0_14103' ,
                     'year_0_14104' , 'year_0_14203' , 'year_0_14204' , 'year_0_14303' ,
                     'year_0_14304' , 'year_0_14503' , 'year_0_14504' , 'year_0_15003' ,
                     'year_0_15004' , 'year_0_15103' , 'year_0_15104' , 'year_0_15203' ,
                     'year_0_15204' , 'year_0_15303' , 'year_0_15304' , 'year_0_15403' ,
                     'year_0_15404' , 'year_0_15503' , 'year_0_15504' , 'year_0_16003' ,
                     'year_0_16004' , 'year_0_17003' , 'year_0_17004' , 'year_0_21003' ,
                     'year_0_21004' , 'year_0_21103' , 'year_0_21104' , 'year_0_21203' ,
                     'year_0_21204' , 'year_0_22003' , 'year_0_22004' , 'year_0_22103' ,
                     'year_0_22104' , 'year_0_22203' , 'year_0_22204' , 'year_0_23003' ,
                     'year_0_23004' , 'year_0_23103' , 'year_0_23104' , 'year_0_23203' ,
                     'year_0_23204' , 'year_0_23303' , 'year_0_23304' , 'year_0_23403' ,
                     'year_0_23404' , 'year_0_23503' , 'year_0_23504' , 'year_0_24003' ,
                     'year_0_24004' , 'year_0_24103' , 'year_0_24104' , 'year_0_24213' ,
                     'year_0_24214' , 'year_0_24303' , 'year_0_24304' , 'year_0_24503' ,
                     'year_0_24504' , 'year_0_24603' , 'year_0_24604' , 'year_0_25003' ,
                     'year_0_25004' , 'year_0_25103' , 'year_0_25104' , 'year_0_25203' ,
                     'year_0_25204' , 'year_0_32003' , 'year_0_32004' , 'year_0_32005' ,
                     'year_0_32006' , 'year_0_32007' , 'year_0_32008' , 'year_0_33003' ,
                     'year_0_33004' , 'year_0_33005' , 'year_0_33006' , 'year_0_33007' ,
                     'year_0_33008' , 'year_0_33103' , 'year_0_33104' , 'year_0_33105' ,
                     'year_0_33106' , 'year_0_33107' , 'year_0_33108' , 'year_0_33117' ,
                     'year_0_33118' , 'year_0_33125' , 'year_0_33127' , 'year_0_33128' ,
                     'year_0_33135' , 'year_0_33137' , 'year_0_33138' , 'year_0_33143' ,
                     'year_0_33144' , 'year_0_33145' , 'year_0_33148' , 'year_0_33153' ,
                     'year_0_33154' , 'year_0_33155' , 'year_0_33157' , 'year_0_33163' ,
                     'year_0_33164' , 'year_0_33165' , 'year_0_33166' , 'year_0_33167' ,
                     'year_0_33168' , 'year_0_33203' , 'year_0_33204' , 'year_0_33205' ,
                     'year_0_33206' , 'year_0_33207' , 'year_0_33208' , 'year_0_33217' ,
                     'year_0_33218' , 'year_0_33225' , 'year_0_33227' , 'year_0_33228' ,
                     'year_0_33235' , 'year_0_33237' , 'year_0_33238' , 'year_0_33243' ,
                     'year_0_33244' , 'year_0_33245' , 'year_0_33247' , 'year_0_33248' ,
                     'year_0_33253' , 'year_0_33254' , 'year_0_33255' , 'year_0_33257' ,
                     'year_0_33258' , 'year_0_33263' , 'year_0_33264' , 'year_0_33265' ,
                     'year_0_33266' , 'year_0_33267' , 'year_0_33268' , 'year_0_33277' ,
                     'year_0_33278' , 'year_0_33305' , 'year_0_33306' , 'year_0_33307' ,
                     'year_0_33406' , 'year_0_33407' , 'year_0_36003' , 'year_0_36004' ,
                     'year_0_41003' , 'year_0_41103' , 'year_0_41113' , 'year_0_41123' ,
                     'year_0_41133' , 'year_0_41193' , 'year_0_41203' , 'year_0_41213' ,
                     'year_0_41223' , 'year_0_41233' , 'year_0_41243' , 'year_0_41293' ,
                     'year_0_42003' , 'year_0_42103' , 'year_0_42113' , 'year_0_42123' ,
                     'year_0_42133' , 'year_0_42143' , 'year_0_42193' , 'year_0_42203' ,
                     'year_0_42213' , 'year_0_42223' , 'year_0_42233' , 'year_0_42243' ,
                     'year_0_42293' , 'year_0_43003' , 'year_0_43103' , 'year_0_43113' ,
                     'year_0_43123' , 'year_0_43133' , 'year_0_43143' , 'year_0_43193' ,
                     'year_0_43203' , 'year_0_43213' , 'year_0_43223' , 'year_0_43233' ,
                     'year_0_43293' , 'year_0_44003' , 'year_0_44903' , 'year_0_61003' ,
                     'year_0_62003' , 'year_0_62103' , 'year_0_62153' , 'year_0_62203' ,
                     'year_0_62303' , 'year_0_62403' , 'year_0_62503' , 'year_0_63003' ,
                     'year_0_63103' , 'year_0_63113' , 'year_0_63123' , 'year_0_63133' ,
                     'year_0_63203' , 'year_0_63213' , 'year_0_63223' , 'year_0_63233' ,
                     'year_0_63243' , 'year_0_63253' , 'year_0_63263' , 'year_0_63303' ,
                     'year_0_63503' , 'year_0_64003'                      ]
	addElToSelector()
</script>